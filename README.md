# **Система компьютерного зрения для БВС - Конкурс СКАТ 2025**

Автономная система распознавания армянских символов размером 3×3 метра с записью GPS координат для Студенческого конкурса авиационного творчества.

## Оборудование

- **Плата**: Khadas VIM3 PRO
- **Камера**: Khadas K-CM-002  
- **OCR**: Tesseract с моделью hye (tessdata_best)
- **Связь**: MAVLink с полетным контроллером
- **Хранение**: SD карта FAT32

## Структура проекта

### Описание ключевых компонентов

#### **main_controller.py**
Главный файл системы, который:
- Координирует работу всех модулей
- Управляет жизненным циклом приложения  
- Обеспечивает автономную работу
- Обрабатывает сигналы завершения

#### **vision_module/**
Модули компьютерного зрения:

| Файл | Назначение |
|------|------------|
| `camera_handler.py` | Захват видео с камеры Khadas K-CM-002, предобработка кадров |
| `symbol_detector.py` | Поиск областей с символами 3×3м на изображении |
| `ocr_processor.py` | Распознавание армянских символов с помощью Tesseract |

#### **flight_controller_module/**
Интеграция с полетным контроллером:

| Файл | Назначение |
|------|------------|
| `mavlink_handler.py` | Подключение к ПК через MAVLink протокол |
| `gps_data.py` | Обработка GPS координат в формате WGS84 |

#### **data_module/**
Сохранение результатов:

| Файл | Назначение |
|------|------------|
| `excel_logger.py` | Запись детекций в Excel и CSV |

#### **utils/**
Вспомогательные модули:

| Файл | Назначение |
|------|------------|
| `config.py` | Загрузка и управление настройками из JSON |

## Формат данных конкурса СКАТ

### **objects-coordinates.csv**
Главный файл для сдачи на конкурсе:
```csv
0,561234567,371234567
15,561235000,371235000
23,561236000,371236000
```

**Формат записи**: `ID_символа,широта×1e7,долгота×1e7`

- **ID символа**: 0-35 (согласно таблице конкурса)
- **Координаты**: GPS в формате WGS84, умноженные на 10⁷
- **Без заголовков**: CSV файл без заголовочной строки

### **flight_YYYYMMDD_HHMMSS.xlsx**
Подробная информация о полете:

| Столбец | Описание |
|---------|----------|
| Timestamp | Время детекции |
| Symbol | Распознанный символ |
| Symbol_ID | ID символа (0-35) |
| Confidence | Уверенность OCR (0.0-1.0) |
| GPS_Lat/Lon/Alt | GPS координаты |
| Image_Path | Путь к сохраненному изображению |
| Detection_X/Y/W/H | Координаты области детекции |

## Автозапуск системы

### **drone-cv.service**
Systemd сервис обеспечивает:
-  Автоматический запуск при включении питания
-  Перезапуск при сбоях
-  Логирование через journald
-  Работа от пользователя khadas

### Управление сервисом:
```bash
# Запуск
sudo systemctl start drone-cv.service

# Остановка  
sudo systemctl stop drone-cv.service

# Статус
sudo systemctl status drone-cv.service

# Логи в реальном времени
journalctl -u drone-cv.service -f
```

##  Рабочий процесс

1. **Включение**: Подача питания → автозапуск системы
2. **Подключение**: Ожидание MAVLink от полетного контроллера  
3. **GPS**: Ожидание качественного GPS сигнала (fix ≥ 3)
4. **Полет**: Автоматическая обработка видео в полете
5. **Детекция**: Поиск и распознавание армянских символов
6. **Запись**: Сохранение результатов в формате конкурса
7. **Посадка**: Корректное завершение записи
8. **Результат**: SD карта с файлом objects-coordinates.csv

##  Управление конфигурацией

Все настройки в файле `config/settings.json`:

```json
{
  "camera_config": {
    "width": 1920,
    "height": 1080,
    "fps": 30
  },
  "detection_config": {
    "min_symbol_area": 2000,
    "max_symbol_area": 100000
  },
  "system_config": {
    "target_fps": 3,
    "min_confidence": 0.8,
    "competition_mode": true
  }
}
```
